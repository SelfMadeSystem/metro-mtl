---
import BackNavigation from "../../components/BackNavigation";
import PathFinding from "../../components/PathFinding";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const linesData = await getCollection("lines");
const lines = linesData.map((line) => line.data);
const linesById = Object.fromEntries(lines.map((line) => [line.id, line]));
const stationsData = await getCollection("stations");
const stations = stationsData.map((station) => ({
  ...station.data,
  lines: station.data.lines
    .map(({ id }) => linesById[id])
    .filter((line): line is NonNullable<typeof line> => Boolean(line)),
}));
---

<Layout
  title="Find Path Between Stations"
  description="Find the best path between two Montreal Metro stations"
>
  <BackNavigation />
  <div class="min-h-screen bg-map">
    <PathFinding stations={stations} lines={lines} client:load />
  </div>
</Layout>
